---
sidebar: sidebar 
permalink: openshift/os-sm-azure-setup.html 
keywords: NetApp Solutions, redhat OpenShift, red hat OpenShift, redhat openshift container platform, ocp, openshift container platform, Advanced Cluster Management, ACM, Hub Cluster, containers, container workloads, VMware, customer managed storage, ONTAP, Azure, Azure Cloud. 
summary:  
---
= Bereitstellen und Konfigurieren der Red Hat OpenShift Container-Plattform auf Azure
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
In diesem Abschnitt wird ein allgemeiner Workflow zum Einrichten und Verwalten von OpenShift-Clustern in Azure und zum Bereitstellen zustandsbehafteter Anwendungen darauf beschrieben.  Es zeigt die Verwendung von NetApp Cloud Volumes ONTAP Speicher mit Hilfe von Trident zur Bereitstellung persistenter Volumes.  Es werden Details zur Verwendung von Trident Protect zur Durchführung von Datenschutz- und Migrationsaktivitäten für die Stateful-Anwendungen bereitgestellt.

Hier ist ein Diagramm, das die auf Azure bereitgestellten und über ein VPN mit dem Rechenzentrum verbundenen Cluster zeigt.

image:rhhc-self-managed-azure.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]


NOTE: Es gibt mehrere Möglichkeiten, Red Hat OpenShift Container-Plattformcluster in Azure bereitzustellen.  Diese allgemeine Beschreibung des Setups enthält Dokumentationslinks für die jeweils verwendete Methode.  Weitere Methoden finden Sie in den entsprechenden Links imlink:os-solutions-resources.html["Ressourcenbereich"] .

Der Einrichtungsprozess kann in die folgenden Schritte unterteilt werden:

.Installieren Sie über die CLI einen OCP-Cluster auf Azure.
[%collapsible%open]
====
* Stellen Sie sicher, dass Sie alle genannten Voraussetzungen erfüllt habenlink:https://docs.openshift.com/container-platform/4.13/installing/installing_azure/installing-azure-vnet.html["hier,"] .
* Erstellen Sie ein VPN, Subnetze und Netzwerksicherheitsgruppen sowie eine private DNS-Zone.  Erstellen Sie ein VPN-Gateway und eine Site-to-Site-VPN-Verbindung.
* Für die VPN-Konnektivität zwischen dem lokalen Standort und Azure wurde eine pfsense-VM erstellt und konfiguriert.  Anweisungen hierzu finden Sie unterlink:https://docs.netgate.com/pfsense/en/latest/recipes/ipsec-s2s-psk.html["hier,"] .
* Besorgen Sie sich das Installationsprogramm und das Pull-Geheimnis und stellen Sie den Cluster gemäß den in der Dokumentation angegebenen Schritten bereit.link:https://docs.openshift.com/container-platform/4.13/installing/installing_azure/installing-azure-vnet.html["hier,"] .
* Die Installation des Clusters ist abgeschlossen und stellt eine Kubeconfig-Datei sowie einen Benutzernamen und ein Kennwort für die Anmeldung bei der Konsole des Clusters bereit.


Unten finden Sie ein Beispiel für eine install-config.yaml-Datei.

....
apiVersion: v1
baseDomain: sddc.netapp.com
compute:
- architecture: amd64
  hyperthreading: Enabled
  name: worker
  platform:
    azure:
      encryptionAtHost: false
      osDisk:
        diskSizeGB: 512
        diskType: "StandardSSD_LRS"
      type: Standard_D2s_v3
      ultraSSDCapability: Disabled
      #zones:
      #- "1"
      #- "2"
      #- "3"
  replicas: 3
controlPlane:
  architecture: amd64
  hyperthreading: Enabled
  name: master
  platform:
    azure:
      encryptionAtHost: false
      osDisk:
        diskSizeGB: 1024
        diskType: Premium_LRS
      type: Standard_D8s_v3
      ultraSSDCapability: Disabled
  replicas: 3
metadata:
  creationTimestamp: null
  name: azure-cluster
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  machineNetwork:
  - cidr: 10.0.0.0/16
  networkType: OVNKubernetes
  serviceNetwork:
  - 172.30.0.0/16
platform:
  azure:
    baseDomainResourceGroupName: ocp-base-domain-rg
    cloudName: AzurePublicCloud
    computeSubnet: ocp-subnet2
    controlPlaneSubnet: ocp-subnet1
    defaultMachinePlatform:
      osDisk:
        diskSizeGB: 1024
        diskType: "StandardSSD_LRS"
      ultraSSDCapability: Disabled
    networkResourceGroupName: ocp-nc-us-rg
    #outboundType: UserDefinedRouting
    region: northcentralus
    resourceGroupName: ocp-cluster-ncusrg
    virtualNetwork: ocp_vnet_ncus
publish: Internal
pullSecret:
....
====
.Stellen Sie Cloud Volumes ONTAP in Azure mit BlueXP bereit.
[%collapsible%open]
====
* Installieren Sie einen Connector in Azure.  Siehe Anweisungen https://docs.netapp.com/us-en/bluexp-setup-admin/task-install-connector-azure-bluexp.html["hier,"] .
* Stellen Sie mithilfe des Connectors eine CVO-Instanz in Azure bereit.  Siehe Link zur Anleitung:https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-getting-started-azure.html [hier.]


====
.Verwenden der CSI-Topologiefunktion von Trident für Mehrzonenarchitekturen
Cloud-Anbieter ermöglichen es Kubernetes/OpenShift-Clusteradministratoren heute, Knoten der Cluster zu erstellen, die zonenbasiert sind.  Knoten können sich in verschiedenen Verfügbarkeitszonen innerhalb einer Region oder über mehrere Regionen verteilt befinden.  Um die Bereitstellung von Volumes für Workloads in einer Multizonenarchitektur zu erleichtern, verwendet Trident die CSI-Topologie.  Mithilfe der CSI-Topologiefunktion kann der Zugriff auf Volumes basierend auf Regionen und Verfügbarkeitszonen auf eine Teilmenge von Knoten beschränkt werden.  Verweisenlink:https://docs.netapp.com/us-en/trident/trident-use/csi-topology.html["hier,"] für weitere Einzelheiten.


NOTE: Kubernetes unterstützt zwei Volume-Bindungsmodi: – Wenn **_VolumeBindingMode_ auf _Immediate_** (Standard) gesetzt ist, erstellt Trident das Volume ohne jegliche Topologieerkennung.  Persistente Volumes werden ohne Abhängigkeit von den Planungsanforderungen des anfordernden Pods erstellt.  – Wenn **_VolumeBindingMode_ auf _WaitForFirstConsumer_** gesetzt ist, wird die Erstellung und Bindung eines persistenten Volumes für ein PVC verzögert, bis ein Pod, der das PVC verwendet, geplant und erstellt wurde.  Auf diese Weise werden Volumes erstellt, die den Planungsbeschränkungen entsprechen, die durch die Topologieanforderungen erzwungen werden.  Trident -Speicher-Backends können so konzipiert werden, dass Volumes basierend auf Verfügbarkeitszonen selektiv bereitgestellt werden (topologiebewusstes Backend).  Für StorageClasses, die ein solches Backend verwenden, wird ein Volume nur erstellt, wenn es von einer Anwendung angefordert wird, die in einer unterstützten Region/Zone geplant ist.  (Topologiebewusste Speicherklasse) Siehelink:https://docs.netapp.com/us-en/trident/trident-use/csi-topology.html["hier,"] für weitere Einzelheiten.
