---
sidebar: sidebar 
permalink: openshift/os-pm-aws-dp.html 
keywords: NetApp Solutions, redhat OpenShift, red hat OpenShift, redhat openshift container platform, ocp, openshift container platform, Advanced Cluster Management, ACM, Hub Cluster, containers, container workloads, VMWare, provider managed storage, ONTAP, AWS FSx ONTAP, Astra Control Service 
summary:  
---
= Datenschutz
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Auf dieser Seite werden die Datenschutzoptionen für Managed Red Hat OpenShift on AWS (ROSA)-Cluster mit Astra Control Service angezeigt.  Astra Control Service (ACS) bietet eine benutzerfreundliche grafische Benutzeroberfläche, mit der Sie Cluster hinzufügen, darauf ausgeführte Anwendungen definieren und anwendungsbezogene Datenverwaltungsaktivitäten durchführen können.  Auf ACS-Funktionen kann auch über eine API zugegriffen werden, die die Automatisierung von Arbeitsabläufen ermöglicht.

Astra Control (ACS oder ACC) wird von NetApp Trident angetrieben.  Trident integriert mehrere Arten von Kubernetes-Clustern wie Red Hat OpenShift, EKS, AKS, SUSE Rancher, Anthos usw. mit verschiedenen Varianten von NetApp ONTAP -Speicher wie FAS/ AFF, ONTAP Select, CVO, Google Google Cloud NetApp Volumes, Azure NetApp Files und Amazon FSx ONTAP.

Dieser Abschnitt enthält Details zu den folgenden Datenschutzoptionen mit ACS:

* Ein Video, das die Sicherung und Wiederherstellung einer ROSA-Anwendung zeigt, die in einer Region ausgeführt und in einer anderen Region wiederhergestellt wird.
* Ein Video, das Snapshot und Wiederherstellung einer ROSA-Anwendung zeigt.
* Schrittweise Anleitung zur Installation eines ROSA-Clusters, Amazon FSx ONTAP, Verwendung von NetApp Trident zur Integration mit dem Speicher-Backend, Installation einer PostgreSQL-Anwendung auf dem ROSA-Cluster, Verwendung von ACS zum Erstellen eines Snapshots der Anwendung und Wiederherstellen der Anwendung daraus.
* Ein Blog, der Schritt für Schritt Details zum Erstellen und Wiederherstellen eines Snapshots für eine MySQL-Anwendung auf einem ROSA-Cluster mit FSx ONTAP unter Verwendung von ACS zeigt.




== Sichern/Aus einer Sicherung wiederherstellen

Das folgende Video zeigt die Sicherung einer ROSA-Anwendung, die in einer Region ausgeführt und in einer anderen Region wiederhergestellt wird.

.FSx NetApp ONTAP für Red Hat OpenShift Service auf AWS
video::01dd455e-7f5a-421c-b501-b01200fa91fd[panopto]


== Snapshot/Wiederherstellung aus Snapshot

Das folgende Video zeigt, wie ein Snapshot einer ROSA-Anwendung erstellt und anschließend aus dem Snapshot wiederhergestellt wird.

.Snapshot/Wiederherstellung für Anwendungen auf Red Hat OpenShift Service auf AWS (ROSA)-Clustern mit Amazon FSx ONTAP -Speicher
video::36ecf505-5d1d-4e99-a6f8-b11c00341793[panopto]


== Der Blog

* link:https://community.netapp.com/t5/Tech-ONTAP-Blogs/Using-Astra-Control-Service-for-data-management-of-apps-on-ROSA-clusters-with/ba-p/450903["Verwenden des Astra Control Service zur Datenverwaltung von Apps auf ROSA-Clustern mit Amazon FSx Speicher"]




== Schritt-für-Schritt-Anleitung zum Erstellen und Wiederherstellen eines Snapshots



=== Erforderliche Einrichtung

* link:https://signin.aws.amazon.com/signin?redirect_uri=https://portal.aws.amazon.com/billing/signup/resume&client_id=signup["AWS-Konto"]
* link:https://console.redhat.com/["Red Hat OpenShift-Konto"]
* IAM-Benutzer mitlink:https://www.rosaworkshop.io/rosa/1-account_setup/["entsprechende Berechtigungen"] zum Erstellen und Zugreifen auf den ROSA-Cluster
* link:https://aws.amazon.com/cli/["AWS CLI"]
* link:https://console.redhat.com/openshift/downloads["ROSA CLI"]
* link:https://console.redhat.com/openshift/downloads["OpenShift-Befehlszeilenschnittstelle"](oc)
* VPC mit Subnetzen und entsprechenden Gateways und Routen
* link:https://docs.openshift.com/rosa/rosa_install_access_delete_clusters/rosa_getting_started_iam/rosa-installing-rosa.html["ROSA-Cluster installiert"]in die VPC
* link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/getting-started-step1.html["Amazon FSx ONTAP"]im selben VPC erstellt
* Zugriff auf den ROSA-Cluster vonlink:https://console.redhat.com/openshift/overview["OpenShift Hybrid Cloud-Konsole"]




=== Nächste Schritte

. Erstellen Sie einen Administratorbenutzer und melden Sie sich beim Cluster an.
. Erstellen Sie eine Kubeconfig-Datei für den Cluster.
. Installieren Sie Trident auf dem Cluster.
. Erstellen Sie mit dem Trident CSI Provisioner eine Backend-, Speicherklassen- und Snapshotklassenkonfiguration.
. Stellen Sie eine PostgreSQL-Anwendung auf dem Cluster bereit.
. Erstellen Sie eine Datenbank und fügen Sie einen Datensatz hinzu.
. Fügen Sie den Cluster zu ACS hinzu.
. Definieren Sie die Anwendung in ACS.
. Erstellen Sie einen Snapshot mit ACS.
. Löschen Sie die Datenbank in der PostgreSQL-Anwendung.
. Wiederherstellung aus einem Snapshot mithilfe von ACS.
. Überprüfen Sie, ob Ihre App aus dem Snapshot wiederhergestellt wurde.




==== **1. Erstellen Sie einen Administratorbenutzer und melden Sie sich beim Cluster an**

Greifen Sie auf den ROSA-Cluster zu, indem Sie mit dem folgenden Befehl einen Administratorbenutzer erstellen: (Sie müssen nur dann einen Administratorbenutzer erstellen, wenn Sie zum Zeitpunkt der Installation noch keinen erstellt haben.)

`rosa create admin --cluster=<cluster-name>`

Der Befehl liefert eine Ausgabe, die wie folgt aussieht.  Melden Sie sich beim Cluster an mit dem `oc login` Befehl in der Ausgabe bereitgestellt.

image:rhhc-rosa-cluster-admin-create.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]


NOTE: Sie können sich auch mit einem Token beim Cluster anmelden.  Wenn Sie zum Zeitpunkt der Clustererstellung bereits einen Administratorbenutzer erstellt haben, können Sie sich mit den Anmeldeinformationen des Administratorbenutzers über die Red Hat OpenShift Hybrid Cloud-Konsole beim Cluster anmelden.  Klicken Sie dann oben rechts auf den Namen des angemeldeten Benutzers, um die `oc login` Befehl (Token-Login) für die Kommandozeile.



==== **2. Erstellen Sie eine Kubeconfig-Datei für den Cluster**

Befolgen Sie die Verfahrenlink:https://docs.netapp.com/us-en/astra-control-service/get-started/create-kubeconfig.html#create-a-kubeconfig-file-for-red-hat-openshift-service-on-aws-rosa-clusters["hier,"] um eine Kubeconfig-Datei für den ROSA-Cluster zu erstellen.  Diese Kubeconfig-Datei wird später verwendet, wenn Sie den Cluster zu ACS hinzufügen.



==== **3. Installieren Sie Trident auf dem Cluster**

Installieren Sie Trident (neueste Version) auf dem ROSA-Cluster.  Dazu können Sie eines der folgenden Verfahren befolgenlink:https://docs.netapp.com/us-en/trident/trident-get-started/kubernetes-deploy.html["hier,"] .  Um Trident mithilfe von Helm von der Konsole des Clusters aus zu installieren, erstellen Sie zunächst ein Projekt namens Trident.

image:rhhc-trident-project-create.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Erstellen Sie dann in der Entwickleransicht ein Helm-Diagramm-Repository.  Verwenden Sie für das URL-Feld `'https://netapp.github.io/trident-helm-chart'` .  Erstellen Sie dann eine Helmversion für den Trident -Operator.

image:rhhc-helm-repo-create.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"] image:rhhc-helm-release-create.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Überprüfen Sie, ob alle Trident-Pods ausgeführt werden, indem Sie zur Administratoransicht auf der Konsole zurückkehren und Pods im Trident-Projekt auswählen.

image:rhhc-trident-installed.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



==== **4. Erstellen Sie eine Backend-, Speicherklassen- und Snapshotklassenkonfiguration mit dem Trident CSI Provisioner**

Verwenden Sie die unten gezeigten YAML-Dateien, um ein Trident-Backend-Objekt, ein Speicherklassenobjekt und das Volumesnapshot-Objekt zu erstellen.  Geben Sie unbedingt die Anmeldeinformationen für Ihr von Ihnen erstelltes Amazon FSx ONTAP -Dateisystem, das Verwaltungs-LIF und den VServer-Namen Ihres Dateisystems im Konfigurations-YAML für das Backend an.  Um diese Details zu erhalten, gehen Sie zur AWS-Konsole für Amazon FSx , wählen Sie das Dateisystem aus und navigieren Sie zur Registerkarte „Administration“.  Klicken Sie außerdem auf „Aktualisieren“, um das Kennwort für die `fsxadmin` Benutzer.


NOTE: Sie können die Objekte über die Befehlszeile erstellen oder sie mit den YAML-Dateien aus der Hybrid Cloud-Konsole erstellen.

image:rhhc-fsx-details.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

** Trident -Backend-Konfiguration**

[source, yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: backend-tbc-ontap-nas-secret
type: Opaque
stringData:
  username: fsxadmin
  password: <password>
---
apiVersion: trident.netapp.io/v1
kind: TridentBackendConfig
metadata:
  name: ontap-nas
spec:
  version: 1
  storageDriverName: ontap-nas
  managementLIF: <management lif>
  backendName: ontap-nas
  svm: fsx
  credentials:
    name: backend-tbc-ontap-nas-secret
----
**Speicherklasse**

[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: ontap-nas
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-nas"
  media: "ssd"
  provisioningType: "thin"
  snapshots: "true"
allowVolumeExpansion: true
----
**Snapshot-Klasse**

[source, yaml]
----
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
  name: trident-snapshotclass
driver: csi.trident.netapp.io
deletionPolicy: Delete
----
Überprüfen Sie, ob das Backend, die Speicherklasse und die Trident-Snapshotclass-Objekte erstellt wurden, indem Sie die unten gezeigten Befehle ausführen.

image:rhhc-tbc-sc-verify.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Zu diesem Zeitpunkt müssen Sie eine wichtige Änderung vornehmen: Legen Sie „ontap-nas“ anstelle von „gp3“ als Standardspeicherklasse fest, damit die PostgreSQL-App, die Sie später bereitstellen, die Standardspeicherklasse verwenden kann.  Wählen Sie in der Openshift-Konsole Ihres Clusters unter „Speicher“ die Option „StorageClasses“ aus.  Bearbeiten Sie die Annotation der aktuellen Standardklasse, sodass sie „false“ ist, und fügen Sie die Annotation storageclass.kubernetes.io/is-default-class hinzu, die für die Speicherklasse ontap-nas auf „true“ gesetzt ist.

image:rhhc-change-default-sc.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

image:rhhc-default-sc.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



==== **5. Stellen Sie eine PostgreSQL-Anwendung auf dem Cluster bereit**

Sie können die Anwendung wie folgt über die Befehlszeile bereitstellen:

`helm install postgresql bitnami/postgresql -n postgresql --create-namespace`

image:rhhc-postgres-install.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]


NOTE: Wenn die Anwendungspods nicht ausgeführt werden, liegt möglicherweise ein Fehler vor, der auf Sicherheitskontextbeschränkungen zurückzuführen ist. image:rhhc-scc-error.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"] Beheben Sie den Fehler, indem Sie die `runAsUser` Und `fsGroup` Felder in `statefuleset.apps/postgresql` Objekt mit der UID, die in der Ausgabe des `oc get project` Befehl wie unten gezeigt.image:rhhc-scc-fix.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Die PostgreSQL-App sollte ausgeführt werden und persistente Volumes verwenden, die durch Amazon FSx ONTAP Speicher unterstützt werden.

image:rhhc-postgres-running.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

image:rhhc-postgres-pvc.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



==== **6. Erstellen Sie eine Datenbank und fügen Sie einen Datensatz hinzu**

image:rhhc-postgres-db-create.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



==== **7. Fügen Sie den Cluster zu ACS hinzu**

Melden Sie sich bei ACS an.  Wählen Sie den Cluster aus und klicken Sie auf „Hinzufügen“.  Wählen Sie „Andere“ aus und laden Sie die Kubeconfig-Datei hoch oder fügen Sie sie ein.

image:rhhc-acs-add-001.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Klicken Sie auf *Weiter* und wählen Sie ontap-nas als Standardspeicherklasse für ACS.  Klicken Sie auf *Weiter*, überprüfen Sie die Details und *Fügen Sie* den Cluster hinzu.

image:rhhc-acs-add-002.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



==== **8. Definieren Sie die Anwendung in ACS**

Definieren Sie die PostgreSQL-Anwendung in ACS.  Wählen Sie auf der Zielseite *Anwendungen*, *Definieren* aus und geben Sie die entsprechenden Details ein.  Klicken Sie einige Male auf *Weiter*, überprüfen Sie die Details und klicken Sie auf *Definieren*.  Die Anwendung wird zu ACS hinzugefügt.

image:rhhc-acs-add-002.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



==== **9. Erstellen Sie einen Snapshot mit ACS**

Es gibt viele Möglichkeiten, einen Snapshot in ACS zu erstellen.  Sie können die Anwendung auswählen und von der Seite aus einen Snapshot erstellen, der die Details der Anwendung anzeigt.  Sie können auf „Snapshot erstellen“ klicken, um einen On-Demand-Snapshot zu erstellen oder eine Schutzrichtlinie zu konfigurieren.

Erstellen Sie einen On-Demand-Snapshot, indem Sie einfach auf *Snapshot erstellen* klicken, einen Namen angeben, die Details überprüfen und auf *Snapshot* klicken.  Der Snapshot-Status ändert sich nach Abschluss des Vorgangs in „Fehlerfrei“.

image:rhhc-snapshot-create.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

image:rhhc-snapshot-on-demand.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



==== **10. Löschen Sie die Datenbank in der PostgreSQL-Anwendung**

Melden Sie sich erneut bei PostgreSQL an, listen Sie die verfügbaren Datenbanken auf, löschen Sie die zuvor erstellte Datenbank und listen Sie sie erneut auf, um sicherzustellen, dass die Datenbank gelöscht wurde.

image:rhhc-postgres-db-delete.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



==== **11. Wiederherstellung aus einem Snapshot mit ACS**

Um die Anwendung aus einem Snapshot wiederherzustellen, gehen Sie zur ACS-UI-Startseite, wählen Sie die Anwendung aus und wählen Sie „Wiederherstellen“.  Sie müssen einen Snapshot oder ein Backup auswählen, aus dem die Wiederherstellung erfolgen soll.  (Normalerweise werden basierend auf einer von Ihnen konfigurierten Richtlinie mehrere erstellt.)  Treffen Sie auf den nächsten Bildschirmen die entsprechenden Entscheidungen und klicken Sie dann auf *Wiederherstellen*.  Der Anwendungsstatus ändert sich von „Wird wiederhergestellt“ in „Verfügbar“, nachdem die Anwendung aus dem Snapshot wiederhergestellt wurde.

image:rhhc-app-restore-001.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

image:rhhc-app-restore-002.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

image:rhhc-app-restore-003.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



==== **12. Überprüfen Sie, ob Ihre App aus dem Snapshot wiederhergestellt wurde**

Melden Sie sich beim PostgreSQL-Client an. Sie sollten nun die Tabelle und den Datensatz in der Tabelle sehen, die Sie zuvor hatten.  Das ist es.  Mit nur einem Mausklick wird Ihre Anwendung in den vorherigen Zustand zurückversetzt.  So einfach machen wir es unseren Kunden mit Astra Control.

image:rhhc-app-restore-verify.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]
