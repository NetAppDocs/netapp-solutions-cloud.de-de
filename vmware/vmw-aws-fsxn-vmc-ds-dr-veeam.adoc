---
sidebar: sidebar 
permalink: vmware/vmw-aws-fsxn-vmc-ds-dr-veeam.html 
keywords: disaster recovery, vmc, vmware cloud, aws, amazon web services, fsxn, FSx ONTAP, FSx ONTAP, disaster recovery, dr, veeam, replication 
summary:  
---
= Verwenden von Veeam Replication und FSx ONTAP für die Notfallwiederherstellung in VMware Cloud auf AWS
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Die Amazon FSx ONTAP Integration mit VMware Cloud auf AWS ist ein von AWS verwalteter externer NFS-Datenspeicher, der auf dem ONTAP -Dateisystem von NetApp basiert und an einen Cluster im SDDC angehängt werden kann.  Es bietet Kunden eine flexible, leistungsstarke virtualisierte Speicherinfrastruktur, die unabhängig von den Rechenressourcen skaliert.



== Überblick

Kunden, die VMware Cloud on AWS SDDC als Disaster Recovery-Ziel verwenden möchten, können FSx ONTAP Datenspeicher verwenden, um Daten vor Ort mithilfe jeder validierten Drittanbieterlösung zu replizieren, die VM-Replikationsfunktionen bietet.  Durch das Hinzufügen des FSx ONTAP Datenspeichers wird eine kostenoptimierte Bereitstellung ermöglicht, als beim Aufbau einer VMware Cloud auf AWS SDDC mit einer enormen Anzahl von ESXi-Hosts, nur um den Speicher unterzubringen.

Dieser Ansatz hilft Kunden auch dabei, Pilot Light Cluster in VMC zusammen mit FSx ONTAP -Datenspeichern zum Hosten der VM-Replikate zu verwenden.  Derselbe Prozess kann auch als Migrationsoption auf VMware Cloud auf AWS erweitert werden, indem ein ordnungsgemäßes Failover des Replikationsplans durchgeführt wird.



== Problemstellung

In diesem Dokument wird beschrieben, wie Sie mithilfe des FSx ONTAP Datenspeichers und der Veeam-Sicherung und -Replikation die Notfallwiederherstellung für lokale VMware-VMs in VMware Cloud auf AWS unter Verwendung der VM-Replikationsfunktion einrichten.

Veeam Backup & Replication ermöglicht die Vor-Ort- und Remote-Replikation für die Notfallwiederherstellung (DR).  Wenn virtuelle Maschinen repliziert werden, erstellt Veeam Backup & Replication eine exakte Kopie der VMs im nativen VMware vSphere-Format auf dem Ziel-VMware Cloud on AWS SDDC-Cluster und hält die Kopie mit der ursprünglichen VM synchronisiert.

Durch die Replikation werden die besten RTO-Werte (Recovery Time Objective) erzielt, da eine Kopie einer VM im startbereiten Zustand vorliegt.  Dieser Replikationsmechanismus stellt sicher, dass die Workloads im Katastrophenfall schnell in VMware Cloud on AWS SDDC gestartet werden können.  Die Veeam Backup & Replication-Software optimiert außerdem die Verkehrsübertragung für die Replikation über WAN und langsame Verbindungen.  Darüber hinaus filtert es auch doppelte Datenblöcke, Null-Datenblöcke, Auslagerungsdateien und ausgeschlossene VM-Gastbetriebssystemdateien heraus und komprimiert den Replikationsverkehr.

Um zu verhindern, dass Replikationsaufträge die gesamte Netzwerkbandbreite verbrauchen, können WAN-Beschleuniger und Netzwerkdrosselungsregeln eingerichtet werden.  Der Replikationsprozess in Veeam Backup & Replication ist auftragsgesteuert, d. h. die Replikation wird durch die Konfiguration von Replikationsaufträgen durchgeführt.  Im Katastrophenfall kann ein Failover ausgelöst werden, um die VMs durch ein Failover auf ihre Replikatkopie wiederherzustellen.

Beim Failover übernimmt eine replizierte VM die Rolle der ursprünglichen VM.  Ein Failover kann auf den neuesten Stand einer Replik oder auf einen ihrer bekannten Wiederherstellungspunkte durchgeführt werden.  Dies ermöglicht bei Bedarf eine Ransomware-Wiederherstellung oder isolierte Tests.  Bei Veeam Backup & Replication sind Failover und Failback temporäre Zwischenschritte, die weiter finalisiert werden sollten.  Veeam Backup & Replication bietet mehrere Optionen zur Handhabung verschiedener Notfallwiederherstellungsszenarien.

image:dr-veeam-fsx-001.png["Diagramm eines DR-Szenarios mit Veeam Replication und FSx ONTAP für VMC"]



== Lösungsbereitstellung



=== Schritte auf hohem Niveau

. Die Veeam Backup- und Replication-Software wird in einer lokalen Umgebung mit entsprechender Netzwerkkonnektivität ausgeführt.
. Konfigurieren Sie VMware Cloud auf AWS. Weitere Informationen finden Sie im VMware Cloud Tech Zone-Artikel.link:https://vmc.techzone.vmware.com/fsx-guide["VMware Cloud auf AWS-Integration mit Amazon FSx ONTAP – Bereitstellungshandbuch"] Konfigurieren Sie zum Bereitstellen VMware Cloud on AWS SDDC und FSx ONTAP als NFS-Datenspeicher.  (Eine Pilotlichtumgebung mit minimaler Konfiguration kann für DR-Zwecke verwendet werden.  Im Falle eines Vorfalls erfolgt ein Failover der VMs auf diesen Cluster und es können zusätzliche Knoten hinzugefügt werden.
. Richten Sie Replikationsjobs ein, um VM-Replikate mit Veeam Backup and Replication zu erstellen.
. Erstellen Sie einen Failover-Plan und führen Sie das Failover durch.
. Wechseln Sie zurück zu Produktions-VMs, sobald das Notfallereignis abgeschlossen ist und die primäre Site aktiv ist.




=== Voraussetzungen für die Veeam VM-Replikation auf VMC- und FSx ONTAP Datenspeicher

. Stellen Sie sicher, dass die Sicherungs-VM von Veeam Backup & Replication mit dem Quell-vCenter sowie den Ziel-VMware-Cloud-on-AWS-SDDC-Clustern verbunden ist.
. Der Sicherungsserver muss in der Lage sein, Kurznamen aufzulösen und eine Verbindung zu Quell- und Ziel-vCentern herzustellen.
. Der Ziel-FSx ONTAP -Datenspeicher muss über genügend freien Speicherplatz verfügen, um VMDKs replizierter VMs zu speichern


Weitere Informationen finden Sie unter "Überlegungen und Einschränkungen"link:https://helpcenter.veeam.com/docs/backup/vsphere/replica_limitations.html?ver=120["hier,"] .



=== Bereitstellungsdetails

.Schritt 1: VMs replizieren
[%collapsible%open]
====
Veeam Backup & Replication nutzt die Snapshot-Funktionen von VMware vSphere und fordert während der Replikation VMware vSphere auf, einen VM-Snapshot zu erstellen.  Der VM-Snapshot ist die zeitpunktbezogene Kopie einer VM, die virtuelle Festplatten, Systemstatus, Konfiguration usw. enthält.  Veeam Backup & Replication verwendet den Snapshot als Datenquelle für die Replikation.

Führen Sie zum Replizieren von VMs die folgenden Schritte aus:

. Öffnen Sie die Veeam Backup & Replication-Konsole.
. Wählen Sie in der Home-Ansicht Replikationsauftrag > Virtuelle Maschine > VMware vSphere aus.
. Geben Sie einen Auftragsnamen an und aktivieren Sie das entsprechende Kontrollkästchen für die erweiterte Steuerung. Klicken Sie auf Weiter.
+
** Aktivieren Sie das Kontrollkästchen „Replica Seeding“, wenn die Bandbreite der Konnektivität zwischen lokalen Standorten und AWS eingeschränkt ist.
** Aktivieren Sie das Kontrollkästchen „Netzwerkneuzuordnung (für AWS VMC-Sites mit unterschiedlichen Netzwerken), wenn die Segmente auf VMware Cloud on AWS SDDC nicht mit denen der lokalen Site-Netzwerke übereinstimmen.
** Wenn sich das IP-Adressschema am lokalen Produktionsstandort vom Schema am AWS VMC-Standort unterscheidet, aktivieren Sie das Kontrollkästchen „Replikat-Re-IP (für DR-Standorte mit anderem IP-Adressschema)“.
+
image:dr-veeam-fsx-002.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



. Wählen Sie im Schritt *Virtuelle Maschinen* die VMs aus, die in den FSx ONTAP -Datenspeicher repliziert werden müssen, der an VMware Cloud on AWS SDDC angeschlossen ist.  Die virtuellen Maschinen können auf vSAN platziert werden, um die verfügbare vSAN-Datenspeicherkapazität zu füllen.  In einem Pilotlichtcluster ist die nutzbare Kapazität eines 3-Knoten-Clusters begrenzt.  Die restlichen Daten können auf FSx ONTAP -Datenspeicher repliziert werden.  Klicken Sie auf *Hinzufügen*, wählen Sie dann im Fenster *Objekt hinzufügen* die erforderlichen VMs oder VM-Container aus und klicken Sie auf *Hinzufügen*. Klicken Sie auf *Weiter*.
+
image:dr-veeam-fsx-003.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

. Wählen Sie anschließend das Ziel als VMware Cloud on AWS SDDC-Cluster/Host und den entsprechenden Ressourcenpool, VM-Ordner und FSx ONTAP -Datenspeicher für VM-Replikate aus.  Klicken Sie dann auf *Weiter*.
+
image:dr-veeam-fsx-004.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

. Erstellen Sie im nächsten Schritt nach Bedarf die Zuordnung zwischen Quell- und Ziel-Virtual-Network.
+
image:dr-veeam-fsx-005.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

. Geben Sie im Schritt *Jobeinstellungen* das Sicherungsrepository an, in dem Metadaten für VM-Replikate, Aufbewahrungsrichtlinien usw. gespeichert werden.
. Aktualisieren Sie die *Quell*- und *Ziel*-Proxyserver im Schritt *Datenübertragung*, belassen Sie die Auswahl *Automatisch* (Standard), lassen Sie die Option *Direkt* ausgewählt und klicken Sie auf *Weiter*.
. Wählen Sie im Schritt *Gastverarbeitung* nach Bedarf die Option *Anwendungsbewusste Verarbeitung aktivieren*. Klicken Sie auf *Weiter*.
+
image:dr-veeam-fsx-006.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

. Wählen Sie den Replikationszeitplan aus, um den Replikationsauftrag regelmäßig auszuführen.
. Überprüfen Sie im Schritt *Zusammenfassung* des Assistenten die Details des Replikationsauftrags.  Um den Job direkt nach dem Schließen des Assistenten zu starten, aktivieren Sie das Kontrollkästchen *Job ausführen, wenn ich auf „Fertig stellen“ klicke*. Andernfalls lassen Sie das Kontrollkästchen deaktiviert.  Klicken Sie dann auf *Fertig*, um den Assistenten zu schließen.
+
image:dr-veeam-fsx-007.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



Sobald der Replikationsauftrag startet, werden die VMs mit dem angegebenen Suffix auf dem Ziel-VMC-SDDC-Cluster/-Host aufgefüllt.

image:dr-veeam-fsx-008.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Weitere Informationen zur Veeam-Replikation finden Sie unterlink:https://helpcenter.veeam.com/docs/backup/vsphere/replication_process.html?ver=120["Funktionsweise der Replikation"] .

====
.Schritt 2: Erstellen eines Failoverplans
[%collapsible%open]
====
Wenn die erste Replikation oder das Seeding abgeschlossen ist, erstellen Sie den Failover-Plan.  Der Failover-Plan hilft dabei, das Failover für abhängige VMs einzeln oder als Gruppe automatisch durchzuführen.  Der Failover-Plan ist die Blaupause für die Reihenfolge, in der die VMs verarbeitet werden, einschließlich der Startverzögerungen.  Der Failover-Plan hilft auch sicherzustellen, dass kritische abhängige VMs bereits ausgeführt werden.

Um den Plan zu erstellen, navigieren Sie zum neuen Unterabschnitt „Replikate“ und wählen Sie „Failover-Plan“ aus.  Wählen Sie die entsprechenden VMs aus.  Veeam Backup & Replication sucht nach den nächstgelegenen Wiederherstellungspunkten zu diesem Zeitpunkt und verwendet diese zum Starten von VM-Replikaten.


NOTE: Der Failover-Plan kann erst hinzugefügt werden, wenn die erste Replikation abgeschlossen ist und sich die VM-Replikate im Status „Bereit“ befinden.


NOTE: Die maximale Anzahl an VMs, die beim Ausführen eines Failover-Plans gleichzeitig gestartet werden können, beträgt 10.


NOTE: Während des Failover-Prozesses werden die Quell-VMs nicht ausgeschaltet.

Um den *Failover-Plan* zu erstellen, gehen Sie wie folgt vor:

. Wählen Sie in der Home-Ansicht *Failover-Plan > VMware vSphere*.
. Geben Sie als Nächstes einen Namen und eine Beschreibung für den Plan ein.  Bei Bedarf können Skripte vor und nach dem Failover hinzugefügt werden.  Führen Sie beispielsweise ein Skript aus, um VMs herunterzufahren, bevor Sie die replizierten VMs starten.
+
image:dr-veeam-fsx-009.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

. Fügen Sie die VMs zum Plan hinzu und ändern Sie die Startreihenfolge und Startverzögerungen der VM, um die Anwendungsabhängigkeiten zu erfüllen.
+
image:dr-veeam-fsx-010.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]



Weitere Informationen zum Erstellen von Replikationsaufträgen finden Sie unterlink:https://helpcenter.veeam.com/docs/backup/vsphere/replica_job.html?ver=120["Erstellen von Replikationsjobs"] .

====
.Schritt 3: Ausführen des Failoverplans
[%collapsible%open]
====
Während des Failovers wird die Quell-VM am Produktionsstandort auf ihre Replik am Disaster-Recovery-Standort umgeschaltet.  Als Teil des Failover-Prozesses stellt Veeam Backup & Replication die VM-Replik am erforderlichen Wiederherstellungspunkt wieder her und verschiebt alle E/A-Aktivitäten von der Quell-VM auf ihre Replik.  Replikate können nicht nur im Katastrophenfall, sondern auch zur Simulation von DR-Übungen verwendet werden.  Während der Failover-Simulation läuft die Quell-VM weiter.  Sobald alle erforderlichen Tests durchgeführt wurden, können Sie das Failover rückgängig machen und zum Normalbetrieb zurückkehren.


NOTE: Stellen Sie sicher, dass eine Netzwerksegmentierung vorhanden ist, um IP-Konflikte während DR-Übungen zu vermeiden.

Um den Failover-Plan zu starten, klicken Sie einfach auf die Registerkarte *Failover-Pläne* und klicken Sie mit der rechten Maustaste auf den Failover-Plan.  Wählen Sie *Start*.  Dabei wird ein Failover unter Verwendung der neuesten Wiederherstellungspunkte der VM-Replikate durchgeführt.  Um ein Failover auf bestimmte Wiederherstellungspunkte von VM-Replikaten durchzuführen, wählen Sie *Starten mit*.

image:dr-veeam-fsx-011.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

image:dr-veeam-fsx-012.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Der Status der VM-Replik ändert sich von „Bereit“ in „Failover“ und VMs werden auf dem Zielcluster/-host von VMware Cloud on AWS SDDC gestartet.

image:dr-veeam-fsx-013.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Sobald das Failover abgeschlossen ist, ändert sich der Status der VMs in „Failover“.

image:dr-veeam-fsx-014.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]


NOTE: Veeam Backup & Replication stoppt alle Replikationsaktivitäten für die Quell-VM, bis deren Replikat wieder in den Zustand „Bereit“ versetzt wird.

Ausführliche Informationen zu Failover-Plänen finden Sie unterlink:https://helpcenter.veeam.com/docs/backup/vsphere/failover_plan.html?ver=120["Failover-Pläne"] .

====
.Schritt 4: Failback zur Produktionssite
[%collapsible%open]
====
Wenn der Failover-Plan ausgeführt wird, wird er als Zwischenschritt betrachtet und muss je nach Bedarf abgeschlossen werden.  Zu den Optionen gehören die folgenden:

* *Failback zur Produktion* – Wechseln Sie zurück zur ursprünglichen VM und übertragen Sie alle Änderungen, die während der Ausführung der VM-Replik vorgenommen wurden, auf die ursprüngliche VM.



NOTE: Wenn Sie ein Failback durchführen, werden Änderungen nur übertragen, aber nicht veröffentlicht.  Wählen Sie *Failback festschreiben* (sobald bestätigt wurde, dass die ursprüngliche VM wie erwartet funktioniert) oder *Failback rückgängig machen*, um zur VM-Replik zurückzukehren, wenn die ursprüngliche VM nicht wie erwartet funktioniert.

* *Failover rückgängig machen* – Wechseln Sie zurück zur ursprünglichen VM und verwerfen Sie alle Änderungen, die während der Ausführung an der VM-Replik vorgenommen wurden.
* *Permanentes Failover* – Wechseln Sie dauerhaft von der Original-VM zu einer VM-Replik und verwenden Sie diese Replik als Original-VM.


In dieser Demo wurde Failback zur Produktion ausgewählt.  Im Schritt „Ziel“ des Assistenten wurde ein Failback zur ursprünglichen VM ausgewählt und das Kontrollkästchen „VM nach der Wiederherstellung einschalten“ aktiviert.

image:dr-veeam-fsx-015.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

image:dr-veeam-fsx-016.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Failback-Commit ist eine der Möglichkeiten, den Failback-Vorgang abzuschließen.  Wenn das Failback ausgeführt wird, wird bestätigt, dass die an die VM gesendeten Änderungen, für die das Failback ausgeführt wird (die Produktions-VM), wie erwartet funktionieren.  Nach dem Commit-Vorgang nimmt Veeam Backup & Replication die Replikationsaktivitäten für die Produktions-VM wieder auf.

Ausführliche Informationen zum Failback-Prozess finden Sie in der Veeam-Dokumentation fürlink:https://helpcenter.veeam.com/docs/backup/vsphere/failover_failback.html?ver=120["Failover und Failback für die Replikation"] .

image:dr-veeam-fsx-017.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

image:dr-veeam-fsx-018.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

Nach einem erfolgreichen Failback zur Produktion werden alle VMs wieder am ursprünglichen Produktionsstandort wiederhergestellt.

image:dr-veeam-fsx-019.png["Abbildung, die einen Eingabe-/Ausgabedialog zeigt oder schriftlichen Inhalt darstellt"]

====


== Abschluss

Die FSx ONTAP Datenspeicherfunktion ermöglicht es Veeam oder jedem validierten Drittanbietertool, eine kostengünstige DR-Lösung mithilfe des Pilot Light Clusters bereitzustellen, ohne eine große Anzahl von Hosts im Cluster bereitstellen zu müssen, nur um die VM-Replikatkopie unterzubringen.  Dies bietet eine leistungsstarke Lösung zur Handhabung eines maßgeschneiderten, individuellen Notfallwiederherstellungsplans und ermöglicht außerdem die Wiederverwendung vorhandener Backup-Produkte im Unternehmen, um die DR-Anforderungen zu erfüllen. Dadurch wird eine Cloud-basierte Notfallwiederherstellung durch Verlassen der DR-Rechenzentren vor Ort ermöglicht.  Das Failover kann als geplantes Failover oder per Mausklick erfolgen, wenn ein Notfall eintritt und die Entscheidung zur Aktivierung der DR-Site getroffen wird.

Um mehr über diesen Vorgang zu erfahren, können Sie sich gerne das ausführliche Walkthrough-Video ansehen.

video::15fed205-8614-4ef7-b2d0-b061015e925a[panopto,width=Video walkthrough of the solution]